<div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title">
      <%= link_to package.name, registry_package_path(package.registry.name, package.name) %>
      <% if package.repository_url.present? %>
        <a href="<%= package.repository_url %>" target="_blank" class="text-decoration-none ms-2">
          <small><%= package.repository_url %></small>
        </a>
      <% end %>
    </h5>

    <div class="mb-2">
      <span class="badge bg-light text-dark">
        <% if package.registry.metadata&.dig('icon_url').present? %>
          <img src="<%= package.registry.metadata['icon_url'] %>" alt="<%= package.registry.name %>" style="width: 16px; height: 16px; margin-right: 4px;">
        <% end %>
        <%= package.registry.name %>
      </span>
    </div>

    <% if package.description_with_fallback.present? %>
      <%= truncate package.description_with_fallback, :length => 100 %><br/>
    <% end %>

    <small class='text-muted'>
      <% if package.downloads.present? && package.downloads > 0 %>
        <%= number_to_human(package.downloads).downcase %> downloads
      <% end %>

      <% if package.dependent_packages_count && package.dependent_packages_count > 0 %>
        <%= '- ' if package.downloads.present? && package.downloads > 0 %><%= pluralize number_with_delimiter(package.dependent_packages_count), 'dependent package' %>
      <% end %>

      <% if package.dependent_repos_count && package.dependent_repos_count > 0 %>
        <%= '- ' if (package.downloads.present? && package.downloads > 0) || (package.dependent_packages_count && package.dependent_packages_count > 0) %><%= pluralize number_with_delimiter(package.dependent_repos_count), 'dependent repositories' %>
      <% end %>

      <% if package.maintainers_count && package.maintainers_count == 1 %>
        <%= '- ' if package.downloads.present? && package.downloads > 0 || package.dependent_packages_count && package.dependent_packages_count > 0 || package.dependent_repos_count && package.dependent_repos_count > 0 %>1 package maintainer
      <% end %>
    </small>

    <% if package.has_repository_stats? %>
      <br>
      <div class="row g-2 text-muted small">
        <% if package.repository_committers_count && package.repository_committers_count > 0 %>
          <div class="col-auto">
            <span class="badge bg-light text-dark">
              <%= number_with_delimiter(package.repository_committers_count) %> committers
            </span>
          </div>
        <% end %>

        <% if package.repository_issue_authors_count && package.repository_issue_authors_count > 0 %>
          <div class="col-auto">
            <span class="badge bg-light text-dark">
              <%= number_with_delimiter(package.repository_issue_authors_count) %> issue authors
            </span>
          </div>
        <% end %>

        <% if package.repository_pr_authors_count && package.repository_pr_authors_count > 0 %>
          <div class="col-auto">
            <span class="badge bg-light text-dark">
              <%= number_with_delimiter(package.repository_pr_authors_count) %> PR authors
            </span>
          </div>
        <% end %>

        <% if package.repository_issues_count && package.repository_issues_count > 0 %>
          <div class="col-auto">
            <span class="badge bg-info text-white">
              <%= number_with_delimiter(package.repository_issues_count) %> issues
            </span>
          </div>
        <% end %>

        <% if package.repository_prs_count && package.repository_prs_count > 0 %>
          <div class="col-auto">
            <span class="badge bg-success text-white">
              <%= number_with_delimiter(package.repository_prs_count) %> PRs
            </span>
          </div>
        <% end %>

        <% if package.repository_maintainers_count && package.repository_maintainers_count > 0 %>
          <div class="col-auto">
            <span class="badge bg-warning text-dark">
              <%= number_with_delimiter(package.repository_maintainers_count) %> maintainers<% if package.repository_host_name %> on <%= package.repository_host_name %><% end %>
            </span>
          </div>
        <% end %>

        <% if package.repository_active_maintainers_count && package.repository_active_maintainers_count > 0 %>
          <div class="col-auto">
            <span class="badge bg-primary text-white">
              <%= number_with_delimiter(package.repository_active_maintainers_count) %> active
            </span>
          </div>
        <% end %>

        <% if package.repository_dds_score && package.repository_dds_score > 0 %>
          <div class="col-auto">
            <span class="badge bg-secondary text-white">
              DDS: <%= package.repository_dds_score.round(3) %>
            </span>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
</div>